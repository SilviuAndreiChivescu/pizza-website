{"ast":null,"code":"import _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\nimport _find from \"lodash/find\";\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport IntlContext from '../IntlProvider/IntlContext';\nimport withLocale from '../IntlProvider/withLocale';\nimport FileItem from './UploadFileItem';\nimport UploadTrigger from './UploadTrigger';\nimport { prefix, ajaxUpload, defaultProps, getUnhandledProps } from '../utils';\nimport { getFiles, guid } from './utils';\n\nvar Uploader = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(Uploader, _React$Component);\n\n  function Uploader(props) {\n    var _this;\n\n    _this = _React$Component.call(this, props) || this;\n    _this.inputRef = void 0;\n\n    _this.handleRemoveFile = function (fileKey) {\n      var _this$props$onRemove, _this$props, _this$props$onChange, _this$props2;\n\n      var fileList = _this.getFileList();\n\n      var file = _find(fileList, function (f) {\n        return f.fileKey === fileKey;\n      });\n\n      var nextFileList = fileList.filter(function (f) {\n        return f.fileKey !== fileKey;\n      });\n\n      if (_this.xhrs[file.fileKey] && _this.xhrs[file.fileKey].readyState !== 4) {\n        _this.xhrs[file.fileKey].abort();\n      }\n\n      _this.setState({\n        fileList: nextFileList\n      });\n\n      (_this$props$onRemove = (_this$props = _this.props).onRemove) === null || _this$props$onRemove === void 0 ? void 0 : _this$props$onRemove.call(_this$props, file);\n      (_this$props$onChange = (_this$props2 = _this.props).onChange) === null || _this$props$onChange === void 0 ? void 0 : _this$props$onChange.call(_this$props2, nextFileList);\n\n      _this.cleanInputValue();\n    };\n\n    _this.handleUploadTriggerChange = function (event) {\n      var _this$props3 = _this.props,\n          autoUpload = _this$props3.autoUpload,\n          shouldQueueUpdate = _this$props3.shouldQueueUpdate,\n          onChange = _this$props3.onChange;\n\n      var fileList = _this.getFileList();\n\n      var files = getFiles(event);\n      var newFileList = [];\n      Array.from(files).forEach(function (file) {\n        newFileList.push({\n          blobFile: file,\n          name: file.name,\n          status: 'inited',\n          fileKey: guid()\n        });\n      });\n      var nextFileList = [].concat(fileList, newFileList);\n      var checkState = shouldQueueUpdate === null || shouldQueueUpdate === void 0 ? void 0 : shouldQueueUpdate(nextFileList, newFileList);\n\n      var upload = function upload() {\n        onChange === null || onChange === void 0 ? void 0 : onChange(nextFileList);\n\n        _this.setState({\n          fileList: nextFileList\n        }, function () {\n          autoUpload && _this.handleAjaxUpload();\n        });\n      };\n\n      if (checkState instanceof Promise) {\n        checkState.then(function (res) {\n          if (res) {\n            upload();\n          }\n        });\n        return;\n      } else if (checkState === false) {\n        _this.cleanInputValue();\n\n        return;\n      }\n\n      upload();\n    };\n\n    _this.handleAjaxUploadSuccess = function (file, response, event, xhr) {\n      var nextFile = _extends({}, file, {\n        status: 'finished',\n        progress: 100\n      });\n\n      _this.updateFileList(nextFile, function () {\n        var _this$props$onSuccess, _this$props4;\n\n        (_this$props$onSuccess = (_this$props4 = _this.props).onSuccess) === null || _this$props$onSuccess === void 0 ? void 0 : _this$props$onSuccess.call(_this$props4, response, nextFile, event, xhr);\n      });\n    };\n\n    _this.handleAjaxUploadError = function (file, status, event, xhr) {\n      var nextFile = _extends({}, file, {\n        status: 'error'\n      });\n\n      _this.updateFileList(nextFile, function () {\n        var _this$props$onError, _this$props5;\n\n        (_this$props$onError = (_this$props5 = _this.props).onError) === null || _this$props$onError === void 0 ? void 0 : _this$props$onError.call(_this$props5, status, nextFile, event, xhr);\n      });\n    };\n\n    _this.handleAjaxUploadProgress = function (file, percent, event, xhr) {\n      var nextFile = _extends({}, file, {\n        status: 'uploading',\n        progress: percent\n      });\n\n      _this.updateFileList(nextFile, function () {\n        var _this$props$onProgres, _this$props6;\n\n        (_this$props$onProgres = (_this$props6 = _this.props).onProgress) === null || _this$props$onProgres === void 0 ? void 0 : _this$props$onProgres.call(_this$props6, percent, nextFile, event, xhr);\n      });\n    };\n\n    _this.handleUploadFile = function (file) {\n      var _this$props7 = _this.props,\n          name = _this$props7.name,\n          action = _this$props7.action,\n          headers = _this$props7.headers,\n          withCredentials = _this$props7.withCredentials,\n          timeout = _this$props7.timeout,\n          data = _this$props7.data,\n          onUpload = _this$props7.onUpload;\n      var xhr = ajaxUpload({\n        name: name,\n        timeout: timeout,\n        headers: headers,\n        data: data,\n        withCredentials: withCredentials,\n        file: file.blobFile,\n        url: action,\n        onError: _this.handleAjaxUploadError.bind(_assertThisInitialized(_this), file),\n        onSuccess: _this.handleAjaxUploadSuccess.bind(_assertThisInitialized(_this), file),\n        onProgress: _this.handleAjaxUploadProgress.bind(_assertThisInitialized(_this), file)\n      });\n\n      _this.updateFileList(_extends({}, file, {\n        status: 'uploading'\n      }));\n\n      _this.xhrs[file.fileKey] = xhr;\n      onUpload === null || onUpload === void 0 ? void 0 : onUpload(file);\n    };\n\n    _this.handleReupload = function (file) {\n      var _this$props8 = _this.props,\n          onReupload = _this$props8.onReupload,\n          autoUpload = _this$props8.autoUpload;\n      autoUpload && _this.handleUploadFile(file);\n      onReupload === null || onReupload === void 0 ? void 0 : onReupload(file);\n    };\n\n    _this.createFile = function (file) {\n      var fileKey = file.fileKey;\n      return _extends({}, file, {\n        fileKey: fileKey || guid(),\n        progress: 0\n      });\n    };\n\n    _this.addPrefix = function (name) {\n      return prefix(_this.props.classPrefix)(name);\n    };\n\n    _this.progressTimer = void 0;\n    _this.xhrs = {};\n    _this.uploadTrigger = null;\n    var _props$defaultFileLis = props.defaultFileList,\n        defaultFileList = _props$defaultFileLis === void 0 ? [] : _props$defaultFileLis;\n\n    var _fileList = defaultFileList.map(_this.createFile);\n\n    _this.state = {\n      fileList: _fileList,\n      fileMap: {}\n    };\n    _this.inputRef = React.createRef();\n    return _this;\n  } // public API\n\n\n  var _proto = Uploader.prototype;\n\n  _proto.start = function start(file) {\n    if (file) {\n      this.handleUploadFile(file);\n      return;\n    }\n\n    this.handleAjaxUpload();\n  };\n\n  _proto.getFileList = function getFileList() {\n    var fileList = this.props.fileList;\n    var fileMap = this.state.fileMap;\n\n    if (typeof fileList !== 'undefined') {\n      return fileList.map(function (file) {\n        return _extends({}, file, {}, fileMap[file.fileKey]);\n      });\n    }\n\n    return this.state.fileList;\n  };\n\n  _proto.cleanInputValue = function cleanInputValue() {\n    if (this.inputRef.current) {\n      this.inputRef.current.getInputInstance().value = '';\n    }\n  };\n\n  _proto.handleAjaxUpload = function handleAjaxUpload() {\n    var _this2 = this;\n\n    var shouldUpload = this.props.shouldUpload;\n    var fileList = this.getFileList();\n    fileList.forEach(function (file) {\n      var checkState = shouldUpload === null || shouldUpload === void 0 ? void 0 : shouldUpload(file);\n\n      if (checkState instanceof Promise) {\n        checkState.then(function (res) {\n          if (res) {\n            _this2.handleUploadFile(file);\n          }\n        });\n        return;\n      } else if (checkState === false) {\n        return;\n      }\n\n      if (file.status === 'inited') {\n        _this2.handleUploadFile(file);\n      }\n    });\n    this.cleanInputValue();\n  };\n\n  _proto.updateFileList = function updateFileList(nextFile, callback) {\n    var fileList = this.getFileList();\n    var nextFileList = fileList.map(function (file) {\n      return file.fileKey === nextFile.fileKey ? nextFile : file;\n    });\n    var nextState = {\n      fileList: nextFileList\n    };\n\n    if (nextFile.progress) {\n      var fileMap = this.state.fileMap;\n      fileMap[nextFile.fileKey] = {\n        progress: nextFile.progress,\n        status: nextFile.status\n      };\n      nextState.fileMap = fileMap;\n    }\n\n    this.setState(nextState, callback);\n  };\n\n  _proto.renderFileItems = function renderFileItems() {\n    var _this3 = this;\n\n    var _this$props9 = this.props,\n        disabledFileItem = _this$props9.disabledFileItem,\n        listType = _this$props9.listType,\n        onPreview = _this$props9.onPreview,\n        maxPreviewFileSize = _this$props9.maxPreviewFileSize,\n        renderFileInfo = _this$props9.renderFileInfo,\n        removable = _this$props9.removable;\n    var fileList = this.getFileList();\n    return React.createElement(\"div\", {\n      key: \"items\",\n      className: this.addPrefix('file-items')\n    }, fileList.map(function (file, index) {\n      return React.createElement(FileItem, {\n        key: file.fileKey || index,\n        file: file,\n        maxPreviewFileSize: maxPreviewFileSize,\n        listType: listType,\n        disabled: disabledFileItem,\n        onPreview: onPreview,\n        onReupload: _this3.handleReupload,\n        onCancel: _this3.handleRemoveFile,\n        renderFileInfo: renderFileInfo,\n        removable: removable\n      });\n    }));\n  };\n\n  _proto.renderUploadTrigger = function renderUploadTrigger() {\n    var _this$props10 = this.props,\n        name = _this$props10.name,\n        multiple = _this$props10.multiple,\n        disabled = _this$props10.disabled,\n        accept = _this$props10.accept,\n        children = _this$props10.children,\n        toggleComponentClass = _this$props10.toggleComponentClass,\n        draggable = _this$props10.draggable,\n        rest = _objectWithoutPropertiesLoose(_this$props10, [\"name\", \"multiple\", \"disabled\", \"accept\", \"children\", \"toggleComponentClass\", \"draggable\"]);\n\n    var unhandled = getUnhandledProps(Uploader, rest);\n    return React.createElement(UploadTrigger, _extends({}, unhandled, {\n      name: name,\n      key: \"trigger\",\n      multiple: multiple,\n      draggable: draggable,\n      disabled: disabled,\n      accept: accept,\n      ref: this.inputRef,\n      onChange: this.handleUploadTriggerChange,\n      componentClass: toggleComponentClass\n    }), children);\n  };\n\n  _proto.render = function render() {\n    var _classNames;\n\n    var _this$props11 = this.props,\n        classPrefix = _this$props11.classPrefix,\n        className = _this$props11.className,\n        listType = _this$props11.listType,\n        fileListVisible = _this$props11.fileListVisible,\n        locale = _this$props11.locale,\n        style = _this$props11.style,\n        draggable = _this$props11.draggable;\n    var classes = classNames(className, classPrefix, this.addPrefix(listType), (_classNames = {}, _classNames[this.addPrefix('draggable')] = draggable, _classNames));\n    var renderList = [this.renderUploadTrigger()];\n\n    if (fileListVisible) {\n      renderList.push(this.renderFileItems());\n    }\n\n    if (listType === 'picture') {\n      renderList.reverse();\n    }\n\n    return React.createElement(IntlContext.Provider, {\n      value: locale\n    }, React.createElement(\"div\", {\n      className: classes,\n      style: style\n    }, renderList));\n  };\n\n  return Uploader;\n}(React.Component);\n\nUploader.propTypes = {\n  action: PropTypes.string,\n  accept: PropTypes.string,\n  autoUpload: PropTypes.bool,\n  children: PropTypes.node,\n  className: PropTypes.string,\n  classPrefix: PropTypes.string,\n  defaultFileList: PropTypes.array,\n  fileList: PropTypes.array,\n  data: PropTypes.object,\n  multiple: PropTypes.bool,\n  disabled: PropTypes.bool,\n  disabledFileItem: PropTypes.bool,\n  name: PropTypes.string,\n  timeout: PropTypes.number,\n  withCredentials: PropTypes.bool,\n  headers: PropTypes.object,\n  locale: PropTypes.object,\n  listType: PropTypes.oneOf(['text', 'picture-text', 'picture']),\n  shouldQueueUpdate: PropTypes.func,\n  shouldUpload: PropTypes.func,\n  onChange: PropTypes.func,\n  onUpload: PropTypes.func,\n  onReupload: PropTypes.func,\n  onPreview: PropTypes.func,\n  onError: PropTypes.func,\n  onSuccess: PropTypes.func,\n  onProgress: PropTypes.func,\n  onRemove: PropTypes.func,\n  maxPreviewFileSize: PropTypes.number,\n  style: PropTypes.object,\n  toggleComponentClass: PropTypes.elementType,\n  renderFileInfo: PropTypes.func,\n  removable: PropTypes.bool,\n  fileListVisible: PropTypes.bool,\n  draggable: PropTypes.bool\n};\nUploader.defaultProps = {\n  autoUpload: true,\n  timeout: 0,\n  name: 'file',\n  multiple: false,\n  disabled: false,\n  withCredentials: false,\n  data: {},\n  listType: 'text',\n  removable: true,\n  fileListVisible: true\n};\nexport default compose(withLocale(['Uploader']), defaultProps({\n  classPrefix: 'uploader'\n}))(Uploader);","map":{"version":3,"sources":["E:/OneDrive - University of Salford/Desktop/pizza-website/node_modules/rsuite/es/Uploader/Uploader.js"],"names":["_objectWithoutPropertiesLoose","_extends","_assertThisInitialized","_inheritsLoose","_find","React","PropTypes","classNames","compose","IntlContext","withLocale","FileItem","UploadTrigger","prefix","ajaxUpload","defaultProps","getUnhandledProps","getFiles","guid","Uploader","_React$Component","props","_this","call","inputRef","handleRemoveFile","fileKey","_this$props$onRemove","_this$props","_this$props$onChange","_this$props2","fileList","getFileList","file","f","nextFileList","filter","xhrs","readyState","abort","setState","onRemove","onChange","cleanInputValue","handleUploadTriggerChange","event","_this$props3","autoUpload","shouldQueueUpdate","files","newFileList","Array","from","forEach","push","blobFile","name","status","concat","checkState","upload","handleAjaxUpload","Promise","then","res","handleAjaxUploadSuccess","response","xhr","nextFile","progress","updateFileList","_this$props$onSuccess","_this$props4","onSuccess","handleAjaxUploadError","_this$props$onError","_this$props5","onError","handleAjaxUploadProgress","percent","_this$props$onProgres","_this$props6","onProgress","handleUploadFile","_this$props7","action","headers","withCredentials","timeout","data","onUpload","url","bind","handleReupload","_this$props8","onReupload","createFile","addPrefix","classPrefix","progressTimer","uploadTrigger","_props$defaultFileLis","defaultFileList","_fileList","map","state","fileMap","createRef","_proto","prototype","start","current","getInputInstance","value","_this2","shouldUpload","callback","nextState","renderFileItems","_this3","_this$props9","disabledFileItem","listType","onPreview","maxPreviewFileSize","renderFileInfo","removable","createElement","key","className","index","disabled","onCancel","renderUploadTrigger","_this$props10","multiple","accept","children","toggleComponentClass","draggable","rest","unhandled","ref","componentClass","render","_classNames","_this$props11","fileListVisible","locale","style","classes","renderList","reverse","Provider","Component","propTypes","string","bool","node","array","object","number","oneOf","func","elementType"],"mappings":"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","sourcesContent":["import _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\nimport _find from \"lodash/find\";\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport IntlContext from '../IntlProvider/IntlContext';\nimport withLocale from '../IntlProvider/withLocale';\nimport FileItem from './UploadFileItem';\nimport UploadTrigger from './UploadTrigger';\nimport { prefix, ajaxUpload, defaultProps, getUnhandledProps } from '../utils';\nimport { getFiles, guid } from './utils';\n\nvar Uploader =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inheritsLoose(Uploader, _React$Component);\n\n  function Uploader(props) {\n    var _this;\n\n    _this = _React$Component.call(this, props) || this;\n    _this.inputRef = void 0;\n\n    _this.handleRemoveFile = function (fileKey) {\n      var _this$props$onRemove, _this$props, _this$props$onChange, _this$props2;\n\n      var fileList = _this.getFileList();\n\n      var file = _find(fileList, function (f) {\n        return f.fileKey === fileKey;\n      });\n\n      var nextFileList = fileList.filter(function (f) {\n        return f.fileKey !== fileKey;\n      });\n\n      if (_this.xhrs[file.fileKey] && _this.xhrs[file.fileKey].readyState !== 4) {\n        _this.xhrs[file.fileKey].abort();\n      }\n\n      _this.setState({\n        fileList: nextFileList\n      });\n\n      (_this$props$onRemove = (_this$props = _this.props).onRemove) === null || _this$props$onRemove === void 0 ? void 0 : _this$props$onRemove.call(_this$props, file);\n      (_this$props$onChange = (_this$props2 = _this.props).onChange) === null || _this$props$onChange === void 0 ? void 0 : _this$props$onChange.call(_this$props2, nextFileList);\n\n      _this.cleanInputValue();\n    };\n\n    _this.handleUploadTriggerChange = function (event) {\n      var _this$props3 = _this.props,\n          autoUpload = _this$props3.autoUpload,\n          shouldQueueUpdate = _this$props3.shouldQueueUpdate,\n          onChange = _this$props3.onChange;\n\n      var fileList = _this.getFileList();\n\n      var files = getFiles(event);\n      var newFileList = [];\n      Array.from(files).forEach(function (file) {\n        newFileList.push({\n          blobFile: file,\n          name: file.name,\n          status: 'inited',\n          fileKey: guid()\n        });\n      });\n      var nextFileList = [].concat(fileList, newFileList);\n      var checkState = shouldQueueUpdate === null || shouldQueueUpdate === void 0 ? void 0 : shouldQueueUpdate(nextFileList, newFileList);\n\n      var upload = function upload() {\n        onChange === null || onChange === void 0 ? void 0 : onChange(nextFileList);\n\n        _this.setState({\n          fileList: nextFileList\n        }, function () {\n          autoUpload && _this.handleAjaxUpload();\n        });\n      };\n\n      if (checkState instanceof Promise) {\n        checkState.then(function (res) {\n          if (res) {\n            upload();\n          }\n        });\n        return;\n      } else if (checkState === false) {\n        _this.cleanInputValue();\n\n        return;\n      }\n\n      upload();\n    };\n\n    _this.handleAjaxUploadSuccess = function (file, response, event, xhr) {\n      var nextFile = _extends({}, file, {\n        status: 'finished',\n        progress: 100\n      });\n\n      _this.updateFileList(nextFile, function () {\n        var _this$props$onSuccess, _this$props4;\n\n        (_this$props$onSuccess = (_this$props4 = _this.props).onSuccess) === null || _this$props$onSuccess === void 0 ? void 0 : _this$props$onSuccess.call(_this$props4, response, nextFile, event, xhr);\n      });\n    };\n\n    _this.handleAjaxUploadError = function (file, status, event, xhr) {\n      var nextFile = _extends({}, file, {\n        status: 'error'\n      });\n\n      _this.updateFileList(nextFile, function () {\n        var _this$props$onError, _this$props5;\n\n        (_this$props$onError = (_this$props5 = _this.props).onError) === null || _this$props$onError === void 0 ? void 0 : _this$props$onError.call(_this$props5, status, nextFile, event, xhr);\n      });\n    };\n\n    _this.handleAjaxUploadProgress = function (file, percent, event, xhr) {\n      var nextFile = _extends({}, file, {\n        status: 'uploading',\n        progress: percent\n      });\n\n      _this.updateFileList(nextFile, function () {\n        var _this$props$onProgres, _this$props6;\n\n        (_this$props$onProgres = (_this$props6 = _this.props).onProgress) === null || _this$props$onProgres === void 0 ? void 0 : _this$props$onProgres.call(_this$props6, percent, nextFile, event, xhr);\n      });\n    };\n\n    _this.handleUploadFile = function (file) {\n      var _this$props7 = _this.props,\n          name = _this$props7.name,\n          action = _this$props7.action,\n          headers = _this$props7.headers,\n          withCredentials = _this$props7.withCredentials,\n          timeout = _this$props7.timeout,\n          data = _this$props7.data,\n          onUpload = _this$props7.onUpload;\n      var xhr = ajaxUpload({\n        name: name,\n        timeout: timeout,\n        headers: headers,\n        data: data,\n        withCredentials: withCredentials,\n        file: file.blobFile,\n        url: action,\n        onError: _this.handleAjaxUploadError.bind(_assertThisInitialized(_this), file),\n        onSuccess: _this.handleAjaxUploadSuccess.bind(_assertThisInitialized(_this), file),\n        onProgress: _this.handleAjaxUploadProgress.bind(_assertThisInitialized(_this), file)\n      });\n\n      _this.updateFileList(_extends({}, file, {\n        status: 'uploading'\n      }));\n\n      _this.xhrs[file.fileKey] = xhr;\n      onUpload === null || onUpload === void 0 ? void 0 : onUpload(file);\n    };\n\n    _this.handleReupload = function (file) {\n      var _this$props8 = _this.props,\n          onReupload = _this$props8.onReupload,\n          autoUpload = _this$props8.autoUpload;\n      autoUpload && _this.handleUploadFile(file);\n      onReupload === null || onReupload === void 0 ? void 0 : onReupload(file);\n    };\n\n    _this.createFile = function (file) {\n      var fileKey = file.fileKey;\n      return _extends({}, file, {\n        fileKey: fileKey || guid(),\n        progress: 0\n      });\n    };\n\n    _this.addPrefix = function (name) {\n      return prefix(_this.props.classPrefix)(name);\n    };\n\n    _this.progressTimer = void 0;\n    _this.xhrs = {};\n    _this.uploadTrigger = null;\n    var _props$defaultFileLis = props.defaultFileList,\n        defaultFileList = _props$defaultFileLis === void 0 ? [] : _props$defaultFileLis;\n\n    var _fileList = defaultFileList.map(_this.createFile);\n\n    _this.state = {\n      fileList: _fileList,\n      fileMap: {}\n    };\n    _this.inputRef = React.createRef();\n    return _this;\n  } // public API\n\n\n  var _proto = Uploader.prototype;\n\n  _proto.start = function start(file) {\n    if (file) {\n      this.handleUploadFile(file);\n      return;\n    }\n\n    this.handleAjaxUpload();\n  };\n\n  _proto.getFileList = function getFileList() {\n    var fileList = this.props.fileList;\n    var fileMap = this.state.fileMap;\n\n    if (typeof fileList !== 'undefined') {\n      return fileList.map(function (file) {\n        return _extends({}, file, {}, fileMap[file.fileKey]);\n      });\n    }\n\n    return this.state.fileList;\n  };\n\n  _proto.cleanInputValue = function cleanInputValue() {\n    if (this.inputRef.current) {\n      this.inputRef.current.getInputInstance().value = '';\n    }\n  };\n\n  _proto.handleAjaxUpload = function handleAjaxUpload() {\n    var _this2 = this;\n\n    var shouldUpload = this.props.shouldUpload;\n    var fileList = this.getFileList();\n    fileList.forEach(function (file) {\n      var checkState = shouldUpload === null || shouldUpload === void 0 ? void 0 : shouldUpload(file);\n\n      if (checkState instanceof Promise) {\n        checkState.then(function (res) {\n          if (res) {\n            _this2.handleUploadFile(file);\n          }\n        });\n        return;\n      } else if (checkState === false) {\n        return;\n      }\n\n      if (file.status === 'inited') {\n        _this2.handleUploadFile(file);\n      }\n    });\n    this.cleanInputValue();\n  };\n\n  _proto.updateFileList = function updateFileList(nextFile, callback) {\n    var fileList = this.getFileList();\n    var nextFileList = fileList.map(function (file) {\n      return file.fileKey === nextFile.fileKey ? nextFile : file;\n    });\n    var nextState = {\n      fileList: nextFileList\n    };\n\n    if (nextFile.progress) {\n      var fileMap = this.state.fileMap;\n      fileMap[nextFile.fileKey] = {\n        progress: nextFile.progress,\n        status: nextFile.status\n      };\n      nextState.fileMap = fileMap;\n    }\n\n    this.setState(nextState, callback);\n  };\n\n  _proto.renderFileItems = function renderFileItems() {\n    var _this3 = this;\n\n    var _this$props9 = this.props,\n        disabledFileItem = _this$props9.disabledFileItem,\n        listType = _this$props9.listType,\n        onPreview = _this$props9.onPreview,\n        maxPreviewFileSize = _this$props9.maxPreviewFileSize,\n        renderFileInfo = _this$props9.renderFileInfo,\n        removable = _this$props9.removable;\n    var fileList = this.getFileList();\n    return React.createElement(\"div\", {\n      key: \"items\",\n      className: this.addPrefix('file-items')\n    }, fileList.map(function (file, index) {\n      return React.createElement(FileItem, {\n        key: file.fileKey || index,\n        file: file,\n        maxPreviewFileSize: maxPreviewFileSize,\n        listType: listType,\n        disabled: disabledFileItem,\n        onPreview: onPreview,\n        onReupload: _this3.handleReupload,\n        onCancel: _this3.handleRemoveFile,\n        renderFileInfo: renderFileInfo,\n        removable: removable\n      });\n    }));\n  };\n\n  _proto.renderUploadTrigger = function renderUploadTrigger() {\n    var _this$props10 = this.props,\n        name = _this$props10.name,\n        multiple = _this$props10.multiple,\n        disabled = _this$props10.disabled,\n        accept = _this$props10.accept,\n        children = _this$props10.children,\n        toggleComponentClass = _this$props10.toggleComponentClass,\n        draggable = _this$props10.draggable,\n        rest = _objectWithoutPropertiesLoose(_this$props10, [\"name\", \"multiple\", \"disabled\", \"accept\", \"children\", \"toggleComponentClass\", \"draggable\"]);\n\n    var unhandled = getUnhandledProps(Uploader, rest);\n    return React.createElement(UploadTrigger, _extends({}, unhandled, {\n      name: name,\n      key: \"trigger\",\n      multiple: multiple,\n      draggable: draggable,\n      disabled: disabled,\n      accept: accept,\n      ref: this.inputRef,\n      onChange: this.handleUploadTriggerChange,\n      componentClass: toggleComponentClass\n    }), children);\n  };\n\n  _proto.render = function render() {\n    var _classNames;\n\n    var _this$props11 = this.props,\n        classPrefix = _this$props11.classPrefix,\n        className = _this$props11.className,\n        listType = _this$props11.listType,\n        fileListVisible = _this$props11.fileListVisible,\n        locale = _this$props11.locale,\n        style = _this$props11.style,\n        draggable = _this$props11.draggable;\n    var classes = classNames(className, classPrefix, this.addPrefix(listType), (_classNames = {}, _classNames[this.addPrefix('draggable')] = draggable, _classNames));\n    var renderList = [this.renderUploadTrigger()];\n\n    if (fileListVisible) {\n      renderList.push(this.renderFileItems());\n    }\n\n    if (listType === 'picture') {\n      renderList.reverse();\n    }\n\n    return React.createElement(IntlContext.Provider, {\n      value: locale\n    }, React.createElement(\"div\", {\n      className: classes,\n      style: style\n    }, renderList));\n  };\n\n  return Uploader;\n}(React.Component);\n\nUploader.propTypes = {\n  action: PropTypes.string,\n  accept: PropTypes.string,\n  autoUpload: PropTypes.bool,\n  children: PropTypes.node,\n  className: PropTypes.string,\n  classPrefix: PropTypes.string,\n  defaultFileList: PropTypes.array,\n  fileList: PropTypes.array,\n  data: PropTypes.object,\n  multiple: PropTypes.bool,\n  disabled: PropTypes.bool,\n  disabledFileItem: PropTypes.bool,\n  name: PropTypes.string,\n  timeout: PropTypes.number,\n  withCredentials: PropTypes.bool,\n  headers: PropTypes.object,\n  locale: PropTypes.object,\n  listType: PropTypes.oneOf(['text', 'picture-text', 'picture']),\n  shouldQueueUpdate: PropTypes.func,\n  shouldUpload: PropTypes.func,\n  onChange: PropTypes.func,\n  onUpload: PropTypes.func,\n  onReupload: PropTypes.func,\n  onPreview: PropTypes.func,\n  onError: PropTypes.func,\n  onSuccess: PropTypes.func,\n  onProgress: PropTypes.func,\n  onRemove: PropTypes.func,\n  maxPreviewFileSize: PropTypes.number,\n  style: PropTypes.object,\n  toggleComponentClass: PropTypes.elementType,\n  renderFileInfo: PropTypes.func,\n  removable: PropTypes.bool,\n  fileListVisible: PropTypes.bool,\n  draggable: PropTypes.bool\n};\nUploader.defaultProps = {\n  autoUpload: true,\n  timeout: 0,\n  name: 'file',\n  multiple: false,\n  disabled: false,\n  withCredentials: false,\n  data: {},\n  listType: 'text',\n  removable: true,\n  fileListVisible: true\n};\nexport default compose(withLocale(['Uploader']), defaultProps({\n  classPrefix: 'uploader'\n}))(Uploader);"]},"metadata":{},"sourceType":"module"}
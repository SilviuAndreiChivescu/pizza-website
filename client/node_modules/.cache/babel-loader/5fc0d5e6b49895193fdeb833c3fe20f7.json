{"ast":null,"code":"import _uniq from \"lodash/uniq\";\nimport _remove from \"lodash/remove\";\nexport default function (props) {\n  var valueKey = props.valueKey,\n      childrenKey = props.childrenKey;\n  /**\n   * 获取一个节点的所有子节点的值\n   * @param {*} item\n   * @param {*} uncheckableItemValues\n   */\n\n  function getChildrenValue(item, uncheckableItemValues) {\n    var values = [];\n\n    if (!item[childrenKey]) {\n      return values;\n    }\n\n    item[childrenKey].forEach(function (n) {\n      if (uncheckableItemValues && !uncheckableItemValues.some(function (v) {\n        return v === n[valueKey];\n      })) {\n        values.push(n[valueKey]);\n      }\n\n      values = values.concat(getChildrenValue(n, uncheckableItemValues));\n    });\n    return values;\n  }\n  /**\n   * 获取一个节点的所有父辈节点\n   * @param {*} item\n   * @param {*} uncheckableItemValues\n   */\n\n\n  function getParents(item) {\n    var parents = [];\n\n    if (!item.parent) {\n      return parents;\n    }\n\n    parents.push(item.parent);\n    parents = parents.concat(getParents(item.parent));\n    return parents;\n  }\n  /**\n   * 删除一个节点下所有已选择的值\n   * @param {*} value\n   * @param {*} item\n   */\n\n\n  function removeAllChildrenValue(value, item) {\n    var removedValue = [];\n\n    if (!item[childrenKey]) {\n      return;\n    }\n\n    item[childrenKey].forEach(function (n) {\n      removedValue = removedValue.concat(_remove(value, function (v) {\n        return v === n[valueKey];\n      }));\n\n      if (n[childrenKey]) {\n        removeAllChildrenValue(value, n);\n      }\n    });\n    return removedValue;\n  }\n\n  function getOtherItemValuesByUnselectChild(itemNode, value) {\n    var parentValues = [];\n    var itemValues = []; // 通过 value 找到当前节点的父节点\n\n    function findParent(item) {\n      parentValues.push(item[valueKey]);\n\n      if (value.some(function (v) {\n        return v === item[valueKey];\n      })) {\n        return item;\n      }\n\n      if (item.parent) {\n        var p = findParent(item.parent);\n\n        if (p) {\n          return p;\n        }\n      }\n\n      return null;\n    } // 通过父节点获取子节点\n\n\n    function pushChildValue(item) {\n      if (!item[childrenKey]) {\n        return;\n      }\n\n      item[childrenKey].forEach(function (n) {\n        //判断是否是直属父级\n        if (parentValues.some(function (v) {\n          return v === n[valueKey];\n        }) && n[childrenKey]) {\n          pushChildValue(n);\n        } else if (n[valueKey] !== itemNode[valueKey]) {\n          itemValues.push(n[valueKey]);\n        }\n      });\n    }\n\n    var parent = findParent(itemNode);\n\n    if (!parent) {\n      return [];\n    }\n\n    pushChildValue(parent);\n    return itemValues;\n  }\n  /**\n   * 拆分值\n   * @param {*} item\n   * @param {*} checked\n   * @param {*} value\n   * @param {*} uncheckableItemValues\n   */\n\n\n  function splitValue(item, checked, value, uncheckableItemValues) {\n    if (uncheckableItemValues === void 0) {\n      uncheckableItemValues = [];\n    }\n\n    var itemValue = item[valueKey];\n    var childrenValue = getChildrenValue(item, uncheckableItemValues);\n    var parents = getParents(item);\n    var nextValue = [].concat(value);\n    var removedValue = [];\n\n    if (checked) {\n      nextValue.push(itemValue); // 删除当前节点下所有的值\n\n      removedValue = removedValue.concat(removeAllChildrenValue(nextValue, item));\n      /**\n       * 遍历当前节点所有祖宗节点\n       * 然后判断这些节点的子节点是否是否全部被选中，则自身也要被选中\n       */\n\n      var _loop = function _loop(i) {\n        // 父节点是否可以选择\n        var isCheckableParent = !uncheckableItemValues.some(function (v) {\n          return v === parents[i][valueKey];\n        });\n\n        if (isCheckableParent) {\n          var isCheckAll = parents[i][childrenKey] // 过滤掉被标识为不可选的选项\n          .filter(function (n) {\n            return !uncheckableItemValues.some(function (v) {\n              return v === n[valueKey];\n            });\n          }) // 检查是否所有节点都被选中\n          .every(function (n) {\n            return nextValue.some(function (v) {\n              return v === n[valueKey];\n            });\n          });\n\n          if (isCheckAll) {\n            // 添加父节点值\n            nextValue.push(parents[i][valueKey]); // 删除父节点下所有的值\n\n            removedValue = removedValue.concat(removeAllChildrenValue(nextValue, parents[i]));\n          }\n        }\n      };\n\n      for (var i = 0; i < parents.length; i++) {\n        _loop(i);\n      }\n    } else {\n      var tempValue = childrenValue.concat(parents.map(function (item) {\n        return item[valueKey];\n      }));\n      nextValue = nextValue.concat(getOtherItemValuesByUnselectChild(item, nextValue)); // 删除相关的子父节点\n\n      removedValue = _remove(nextValue, function (v) {\n        // 删除自己\n        if (v === itemValue) {\n          return true;\n        }\n\n        return tempValue.some(function (n) {\n          return n === v;\n        });\n      });\n    }\n\n    var uniqValue = _uniq(nextValue);\n\n    var uniqRemovedValue = _uniq(removedValue);\n\n    return {\n      value: uniqValue,\n      removedValue: uniqRemovedValue\n    };\n  }\n  /**\n   * 在 value 中的值存在级联的情况下\n   * 通过 value 重新计算出一个新的 value\n   */\n\n\n  function transformValue(value, flattenData, uncheckableItemValues) {\n    var tempRemovedValue = [];\n    var nextValue = [];\n\n    var _loop2 = function _loop2(i) {\n      // 如果当前 value 中的值已经在被删除列表中则不处理\n      if (tempRemovedValue.some(function (v) {\n        return v === value[i];\n      })) {\n        return \"continue\";\n      }\n\n      var item = flattenData.find(function (v) {\n        return v[valueKey] === value[i];\n      });\n\n      if (!item) {\n        return \"continue\";\n      }\n\n      var sv = splitValue(item, true, value, uncheckableItemValues);\n      tempRemovedValue = _uniq(tempRemovedValue.concat(sv.removedValue)); // 获取到所有相关的值\n\n      nextValue = _uniq(nextValue.concat(sv.value));\n    };\n\n    for (var i = 0; i < value.length; i++) {\n      var _ret = _loop2(i);\n\n      if (_ret === \"continue\") continue;\n    } // 最后遍历所有的 nextValue, 如果它的父节点也在nextValue则删除\n\n\n    return nextValue.filter(function (v) {\n      var item = flattenData.find(function (n) {\n        return n[valueKey] === v;\n      });\n\n      if ((item === null || item === void 0 ? void 0 : item.parent) && nextValue.some(function (v) {\n        return v === item.parent[valueKey];\n      })) {\n        return false;\n      }\n\n      return true;\n    });\n  }\n\n  function getItems(selectNode, flattenData) {\n    var items = [];\n\n    function findParent(item) {\n      if (item[childrenKey]) {\n        items.push(item[childrenKey]);\n      }\n\n      if (item.parent) {\n        findParent(item.parent);\n      }\n    }\n\n    if (selectNode) {\n      findParent(selectNode);\n    }\n\n    items.push(flattenData.filter(function (item) {\n      return item.parent === null;\n    }));\n    return items.reverse();\n  }\n\n  function isSomeChildChecked(node, value) {\n    if (value === void 0) {\n      value = [];\n    }\n\n    if (!node[childrenKey] || !value) {\n      return false;\n    }\n\n    return node[childrenKey].some(function (child) {\n      var _child$childrenKey;\n\n      if (value.some(function (n) {\n        return n === child[valueKey];\n      })) {\n        return true;\n      }\n\n      if ((_child$childrenKey = child[childrenKey]) === null || _child$childrenKey === void 0 ? void 0 : _child$childrenKey.length) {\n        return isSomeChildChecked(child, value);\n      }\n\n      return false;\n    });\n  }\n\n  function isSomeParentChecked(node, value) {\n    if (value === void 0) {\n      value = [];\n    }\n\n    if (!value) {\n      return false;\n    }\n\n    if (value.some(function (n) {\n      return n === node[valueKey];\n    })) {\n      return true;\n    }\n\n    if (node.parent) {\n      return isSomeParentChecked(node.parent, value);\n    }\n\n    return false;\n  }\n\n  return {\n    removeAllChildrenValue: removeAllChildrenValue,\n    getChildrenValue: getChildrenValue,\n    splitValue: splitValue,\n    transformValue: transformValue,\n    getOtherItemValuesByUnselectChild: getOtherItemValuesByUnselectChild,\n    getItems: getItems,\n    isSomeChildChecked: isSomeChildChecked,\n    isSomeParentChecked: isSomeParentChecked\n  };\n}","map":{"version":3,"sources":["E:/OneDrive - University of Salford/Desktop/pizza-website/node_modules/rsuite/es/MultiCascader/utils.js"],"names":["_uniq","_remove","props","valueKey","childrenKey","getChildrenValue","item","uncheckableItemValues","values","forEach","n","some","v","push","concat","getParents","parents","parent","removeAllChildrenValue","value","removedValue","getOtherItemValuesByUnselectChild","itemNode","parentValues","itemValues","findParent","p","pushChildValue","splitValue","checked","itemValue","childrenValue","nextValue","_loop","i","isCheckableParent","isCheckAll","filter","every","length","tempValue","map","uniqValue","uniqRemovedValue","transformValue","flattenData","tempRemovedValue","_loop2","find","sv","_ret","getItems","selectNode","items","reverse","isSomeChildChecked","node","child","_child$childrenKey","isSomeParentChecked"],"mappings":"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","sourcesContent":["import _uniq from \"lodash/uniq\";\nimport _remove from \"lodash/remove\";\nexport default function (props) {\n  var valueKey = props.valueKey,\n      childrenKey = props.childrenKey;\n  /**\n   * 获取一个节点的所有子节点的值\n   * @param {*} item\n   * @param {*} uncheckableItemValues\n   */\n\n  function getChildrenValue(item, uncheckableItemValues) {\n    var values = [];\n\n    if (!item[childrenKey]) {\n      return values;\n    }\n\n    item[childrenKey].forEach(function (n) {\n      if (uncheckableItemValues && !uncheckableItemValues.some(function (v) {\n        return v === n[valueKey];\n      })) {\n        values.push(n[valueKey]);\n      }\n\n      values = values.concat(getChildrenValue(n, uncheckableItemValues));\n    });\n    return values;\n  }\n  /**\n   * 获取一个节点的所有父辈节点\n   * @param {*} item\n   * @param {*} uncheckableItemValues\n   */\n\n\n  function getParents(item) {\n    var parents = [];\n\n    if (!item.parent) {\n      return parents;\n    }\n\n    parents.push(item.parent);\n    parents = parents.concat(getParents(item.parent));\n    return parents;\n  }\n  /**\n   * 删除一个节点下所有已选择的值\n   * @param {*} value\n   * @param {*} item\n   */\n\n\n  function removeAllChildrenValue(value, item) {\n    var removedValue = [];\n\n    if (!item[childrenKey]) {\n      return;\n    }\n\n    item[childrenKey].forEach(function (n) {\n      removedValue = removedValue.concat(_remove(value, function (v) {\n        return v === n[valueKey];\n      }));\n\n      if (n[childrenKey]) {\n        removeAllChildrenValue(value, n);\n      }\n    });\n    return removedValue;\n  }\n\n  function getOtherItemValuesByUnselectChild(itemNode, value) {\n    var parentValues = [];\n    var itemValues = []; // 通过 value 找到当前节点的父节点\n\n    function findParent(item) {\n      parentValues.push(item[valueKey]);\n\n      if (value.some(function (v) {\n        return v === item[valueKey];\n      })) {\n        return item;\n      }\n\n      if (item.parent) {\n        var p = findParent(item.parent);\n\n        if (p) {\n          return p;\n        }\n      }\n\n      return null;\n    } // 通过父节点获取子节点\n\n\n    function pushChildValue(item) {\n      if (!item[childrenKey]) {\n        return;\n      }\n\n      item[childrenKey].forEach(function (n) {\n        //判断是否是直属父级\n        if (parentValues.some(function (v) {\n          return v === n[valueKey];\n        }) && n[childrenKey]) {\n          pushChildValue(n);\n        } else if (n[valueKey] !== itemNode[valueKey]) {\n          itemValues.push(n[valueKey]);\n        }\n      });\n    }\n\n    var parent = findParent(itemNode);\n\n    if (!parent) {\n      return [];\n    }\n\n    pushChildValue(parent);\n    return itemValues;\n  }\n  /**\n   * 拆分值\n   * @param {*} item\n   * @param {*} checked\n   * @param {*} value\n   * @param {*} uncheckableItemValues\n   */\n\n\n  function splitValue(item, checked, value, uncheckableItemValues) {\n    if (uncheckableItemValues === void 0) {\n      uncheckableItemValues = [];\n    }\n\n    var itemValue = item[valueKey];\n    var childrenValue = getChildrenValue(item, uncheckableItemValues);\n    var parents = getParents(item);\n    var nextValue = [].concat(value);\n    var removedValue = [];\n\n    if (checked) {\n      nextValue.push(itemValue); // 删除当前节点下所有的值\n\n      removedValue = removedValue.concat(removeAllChildrenValue(nextValue, item));\n      /**\n       * 遍历当前节点所有祖宗节点\n       * 然后判断这些节点的子节点是否是否全部被选中，则自身也要被选中\n       */\n\n      var _loop = function _loop(i) {\n        // 父节点是否可以选择\n        var isCheckableParent = !uncheckableItemValues.some(function (v) {\n          return v === parents[i][valueKey];\n        });\n\n        if (isCheckableParent) {\n          var isCheckAll = parents[i][childrenKey] // 过滤掉被标识为不可选的选项\n          .filter(function (n) {\n            return !uncheckableItemValues.some(function (v) {\n              return v === n[valueKey];\n            });\n          }) // 检查是否所有节点都被选中\n          .every(function (n) {\n            return nextValue.some(function (v) {\n              return v === n[valueKey];\n            });\n          });\n\n          if (isCheckAll) {\n            // 添加父节点值\n            nextValue.push(parents[i][valueKey]); // 删除父节点下所有的值\n\n            removedValue = removedValue.concat(removeAllChildrenValue(nextValue, parents[i]));\n          }\n        }\n      };\n\n      for (var i = 0; i < parents.length; i++) {\n        _loop(i);\n      }\n    } else {\n      var tempValue = childrenValue.concat(parents.map(function (item) {\n        return item[valueKey];\n      }));\n      nextValue = nextValue.concat(getOtherItemValuesByUnselectChild(item, nextValue)); // 删除相关的子父节点\n\n      removedValue = _remove(nextValue, function (v) {\n        // 删除自己\n        if (v === itemValue) {\n          return true;\n        }\n\n        return tempValue.some(function (n) {\n          return n === v;\n        });\n      });\n    }\n\n    var uniqValue = _uniq(nextValue);\n\n    var uniqRemovedValue = _uniq(removedValue);\n\n    return {\n      value: uniqValue,\n      removedValue: uniqRemovedValue\n    };\n  }\n  /**\n   * 在 value 中的值存在级联的情况下\n   * 通过 value 重新计算出一个新的 value\n   */\n\n\n  function transformValue(value, flattenData, uncheckableItemValues) {\n    var tempRemovedValue = [];\n    var nextValue = [];\n\n    var _loop2 = function _loop2(i) {\n      // 如果当前 value 中的值已经在被删除列表中则不处理\n      if (tempRemovedValue.some(function (v) {\n        return v === value[i];\n      })) {\n        return \"continue\";\n      }\n\n      var item = flattenData.find(function (v) {\n        return v[valueKey] === value[i];\n      });\n\n      if (!item) {\n        return \"continue\";\n      }\n\n      var sv = splitValue(item, true, value, uncheckableItemValues);\n      tempRemovedValue = _uniq(tempRemovedValue.concat(sv.removedValue)); // 获取到所有相关的值\n\n      nextValue = _uniq(nextValue.concat(sv.value));\n    };\n\n    for (var i = 0; i < value.length; i++) {\n      var _ret = _loop2(i);\n\n      if (_ret === \"continue\") continue;\n    } // 最后遍历所有的 nextValue, 如果它的父节点也在nextValue则删除\n\n\n    return nextValue.filter(function (v) {\n      var item = flattenData.find(function (n) {\n        return n[valueKey] === v;\n      });\n\n      if ((item === null || item === void 0 ? void 0 : item.parent) && nextValue.some(function (v) {\n        return v === item.parent[valueKey];\n      })) {\n        return false;\n      }\n\n      return true;\n    });\n  }\n\n  function getItems(selectNode, flattenData) {\n    var items = [];\n\n    function findParent(item) {\n      if (item[childrenKey]) {\n        items.push(item[childrenKey]);\n      }\n\n      if (item.parent) {\n        findParent(item.parent);\n      }\n    }\n\n    if (selectNode) {\n      findParent(selectNode);\n    }\n\n    items.push(flattenData.filter(function (item) {\n      return item.parent === null;\n    }));\n    return items.reverse();\n  }\n\n  function isSomeChildChecked(node, value) {\n    if (value === void 0) {\n      value = [];\n    }\n\n    if (!node[childrenKey] || !value) {\n      return false;\n    }\n\n    return node[childrenKey].some(function (child) {\n      var _child$childrenKey;\n\n      if (value.some(function (n) {\n        return n === child[valueKey];\n      })) {\n        return true;\n      }\n\n      if ((_child$childrenKey = child[childrenKey]) === null || _child$childrenKey === void 0 ? void 0 : _child$childrenKey.length) {\n        return isSomeChildChecked(child, value);\n      }\n\n      return false;\n    });\n  }\n\n  function isSomeParentChecked(node, value) {\n    if (value === void 0) {\n      value = [];\n    }\n\n    if (!value) {\n      return false;\n    }\n\n    if (value.some(function (n) {\n      return n === node[valueKey];\n    })) {\n      return true;\n    }\n\n    if (node.parent) {\n      return isSomeParentChecked(node.parent, value);\n    }\n\n    return false;\n  }\n\n  return {\n    removeAllChildrenValue: removeAllChildrenValue,\n    getChildrenValue: getChildrenValue,\n    splitValue: splitValue,\n    transformValue: transformValue,\n    getOtherItemValuesByUnselectChild: getOtherItemValuesByUnselectChild,\n    getItems: getItems,\n    isSomeChildChecked: isSomeChildChecked,\n    isSomeParentChecked: isSomeParentChecked\n  };\n}"]},"metadata":{},"sourceType":"module"}